<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <style>
      .hidden {
        display: none;
      }
    </style>
    <script src="scripts/fetchWrapper.js" type="text/javascript"></script>
    <script src="scripts/create.js" type="text/javascript"></script>
    <script src="scripts/delete.js" type="text/javascript"></script>
    <title>VideoGames api client</title>
  </head>
  <body>
    <div class="container mt-5">
      <h1>Update Management</h1>

      <div id="liveAlertPlaceholder" class="d-none"></div>

      <div class="mb-3">
        <label for="action" class="form-label">Choose Action</label>
        <select class="form-select" id="action" onchange="toggleForm()">
          <option value="create">Create Update</option>
          <option value="delete">Delete Update</option>
        </select>
      </div>

      <form id="create-form" class="mt-4">
        <h3>Create Update</h3>
        <div class="mb-3">
          <label for="Limited_Time_Event" class="form-label"
            >Limited Time Event</label
          >
          <input
            type="number"
            class="form-control"
            id="Limited_Time_Event"
            placeholder="Enter Limited Time Event"
            min="0"
            max="1"
            step="1"
            required
          />
        </div>
        <div class="mb-3">
          <label for="Game_Id" class="form-label">Game ID</label>
          <input
            type="number"
            class="form-control"
            id="Game_Id"
            placeholder="Enter Game ID"
            min="0"
            required
          />
        </div>
        <div class="mb-3">
          <label for="Date" class="form-label">Date</label>
          <input type="date" class="form-control" id="Date" required />
        </div>
        <div class="mb-3">
          <label for="Description" class="form-label">Description</label>
          <textarea
            class="form-control"
            id="Description"
            rows="3"
            placeholder="Enter description"
            required
          ></textarea>
        </div>
        <div class="mb-3">
          <label for="Version_Number" class="form-label">Version Number</label>
          <input
            type="text"
            class="form-control"
            id="Version_Number"
            placeholder="Enter Version Number"
            required
          />
        </div>
        <div class="mb-3">
          <label for="Update_Size" class="form-label">Update Size (MB)</label>
          <input
            type="number"
            id="Update_Size"
            class="form-control"
            name="Update_Size"
            min="0.1"
            step="any"
            required
          />
        </div>
        <div class="mb-3">
          <label for="New_Features" class="form-label">New Features</label>
          <textarea
            class="form-control"
            id="New_Features"
            rows="3"
            placeholder="Enter New Features"
            required
          ></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Create Update</button>
      </form>

      <form id="delete-form" class="mt-4 hidden">
        <h3>Delete Update</h3>
        <div class="mb-3">
          <label for="Update_ID" class="form-label">Update ID</label>
          <input
            type="number"
            class="form-control"
            id="Update_ID"
            placeholder="Enter Update ID to delete"
            min="1"
            required
          />
        </div>
        <button type="submit" class="btn btn-danger">Delete Update</button>
      </form>
    </div>

    <script>
      function toggleForm() {
        const action = document.getElementById("action").value;
        const createForm = document.getElementById("create-form");
        const deleteForm = document.getElementById("delete-form");

        if (action === "create") {
          createForm.classList.remove("hidden");
          deleteForm.classList.add("hidden");
        } else {
          createForm.classList.add("hidden");
          deleteForm.classList.remove("hidden");
        }
      }
      document
        .getElementById("create-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const updateData = {
            Limited_Time_Event:
              document.getElementById("Limited_Time_Event").value,
            Game_Id: document.getElementById("Game_Id").value,
            Date: document.getElementById("Date").value,
            Description: document.getElementById("Description").value,
            Version_Number: document.getElementById("Version_Number").value,
            Update_Size: document.getElementById("Update_Size").value,
            New_Features: document.getElementById("New_Features").value,
          };
          postUpdate(updateData);
        });

      document
        .getElementById("delete-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const updateId = {
            id: document.getElementById("Update_ID").value,
          };
          deleteUpdate(updateId);
        });

      const showAlert = (message, type) => {
        const alertPlaceholder = document.getElementById(
          "liveAlertPlaceholder"
        );

        const wrapper = document.createElement("div");
        wrapper.innerHTML = [
          `<div class="alert alert-${type} alert-dismissible fade show" role="alert">`,
          `   <div>${message}</div>`,
          '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
          "</div>",
        ].join("");

        alertPlaceholder.classList.remove("d-none");
        alertPlaceholder.append(wrapper);

        setTimeout(() => {
          wrapper.remove();
        }, 5000);
      };
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
